---
import Benefits from "@/components/features/Benefits.astro";
import Hero from "@/components/features/Hero.astro";
import More from "@/components/features/More.astro";
import Trust from "@/components/features/Trust.astro";
import Feature from "@/components/home/Feature.astro";
import Base from "@/layouts/Base.astro";
import { supportedLang, getLangFromUrl } from "@/lib/utils/languageParser";

export function getStaticPaths() {
  const paths = supportedLang.map((lang) => ({
    params: { lang: lang || undefined },
  }));
  return paths;
}

const { lang } = Astro.params;
const language = lang || getLangFromUrl(Astro.url);

// WordPress Daten abrufen (optional)
let wpData = null;
const wpSlug = lang === "en" ? "features-en" : "features-de";
const username = "adjective";
const password = "marvelous";
const auth = btoa(`${username}:${password}`);

try {
  const res = await fetch(`https://next-boats.localsite.io/wp-json/wp/v2/pages?slug=${wpSlug}`, {
    headers: {
      Authorization: `Basic ${auth}`,
    },
  });
  const data = await res.json();
  wpData = data.length > 0 ? data[0] : null;
} catch (err) {
  console.error("❌ Fehler beim Laden von WordPress-Daten:", err);
}

// Inhalte manuell definieren – Feature kommt **nur** von WordPress oder von hier
const title = wpData?.acf?.title || "Manueller Fallback-Titel";
const meta_title = wpData?.acf?.meta_title || "Manueller Meta Title";
const description = wpData?.acf?.description || "Manuelle Seitenbeschreibung";

const hero = wpData?.acf?.hero || {
  title: "Hero Titel Fallback",
  description: "", // Wichtig für marked()
  image: null,
};

const benefit = wpData?.acf?.benefit || {
  title: "Unsere Vorteile",
  description: "", // falls vorhanden
  items: [],
};

const trust = wpData?.acf?.trust || {
  title: "Vertrauen",
  description: "",
};

const more = wpData?.acf?.more || {
  title: "Mehr entdecken",
  description: "",
  items: [],
};

// Feature kommt nur von WordPress oder von hier manuell
const feature = wpData?.acf?.feature?.items || [
  {
    title: "Manuelles Feature 1",
    description: "Beschreibung für manuelles Feature 1",
    icon: "icon-1",
  },
  {
    title: "Manuelles Feature 2",
    description: "Beschreibung für manuelles Feature 2",
    icon: "icon-2",
  },
];
---

<Base title={title} meta_title={meta_title} description={description}>
  <Hero {hero} />
  <Benefits {benefit} />
  <Feature {feature} />
  <Trust {trust} />
  <More {more} />
</Base>
